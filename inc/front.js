// Generated by CoffeeScript 1.7.1
(function() {
  var $btn_stlist, load_stlist, star_click, x;

  window.util = x = {};

  $btn_stlist = $("#btn_stlist");

  star_click = function(evt) {
    if ($(this).data("fav")) {
      $(this).data("fav", 0);
      return $(this).children(".glyphicon").removeClass("glyphicon-star").addClass("glyphicon-star-empty");
    } else {
      $(this).data("fav", 1);
      return $(this).children(".glyphicon").removeClass("glyphicon-star-empty").addClass("glyphicon-star");
    }
  };

  load_stlist = function() {
    $btn_stlist.prop("disabled", 1);
    return $.getJSON("/st_list", function(data) {
      if (!data.st_list) {
        return alert("Ошибка при загрузке данных!");
      }
      $("#stlist").html("");
      return $.each(data.st_list, function(i, v) {
        var item;
        item = $("<div class='item'>");
        item.append($("<div class='star'>").data("st", v._id).data("fav", 0).click(star_click).append("<span class='glyphicon glyphicon-star-empty'></span>"));
        item.append($("<div class='title'>").text(v.title));
        item.append($("<div class='addr'>").text(v.addr || v.descr));
        return $("#stlist").append(item);
      });
    }).always(function() {
      return $btn_stlist.removeProp("disabled");
    });
  };

  $btn_stlist.click(load_stlist);

}).call(this);
